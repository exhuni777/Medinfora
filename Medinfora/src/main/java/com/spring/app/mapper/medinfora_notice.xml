<?xml version="1.0" encoding="UTF-8"?>

<!-- ==== #29. mapper 기본설정 ==== -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.spring.app.notice.model.NoticeDAO">
		
	<insert id="noticeWrite" parameterType="NoticeDTO">
		insert into notice (nidx, userid, title, content, viewcnt, writeday)
        values (seq_notice.nextval, #{userid}, #{title}, #{content}, #{viewcnt}, #{writeday})
    </insert>
    
	 <select id="boardListNoSearch" resultType="NoticeDTO">
		select nidx, userid, title, content, viewcnt, TO_CHAR(TO_DATE(writeday, 'yyyy-mm-dd hh24:mi:ss'), 'yyyy-mm-dd hh24:mi:ss') AS writeday, filename, orgname, filesize
		from notice
		order by nidx desc;
    </select>
    
    <!-- 총 게시물 건수(totalCount) 구하기 - 검색이 있을 때와 검색이 없을 때로 나뉜다 -->
    <select id="getTotalCount" parameterType="HashMap" resultType="int">
        SELECT COUNT(*)
        FROM notice
        WHERE 1=1
        <if test="searchType != null and searchType != ''">
            AND ${searchType} LIKE '%' || #{searchWord} || '%'
        </if>
    </select>

    <!-- 글목록 가져오기(페이징 처리 했으며, 검색어가 있는 것 또는 검색어 없는 것 모두 포함한 것 -->
    <select id="noticeListSearch_withPaging" parameterType="HashMap" resultType="NoticeDTO">
        SELECT nidx, userid, title, content, viewcnt, 
               TO_CHAR(TO_DATE(writeday, 'YYYYMMDD'), 'yyyy-mm-dd') AS writeday,
               filename, orgname, filesize
        FROM (
            SELECT rownum AS rno, nidx, userid, title, content, viewcnt, writeday, filename, orgname, filesize
            FROM notice
            WHERE 1=1
            <if test="searchType != null and searchType != ''">
                AND ${searchType} LIKE '%' || #{searchWord} || '%'
            </if>
            ORDER BY nidx DESC
        )
        WHERE rno BETWEEN #{startRno} AND #{endRno}
    </select>
	
</mapper>